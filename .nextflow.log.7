Jul-18 21:26:21.860 [main] DEBUG nextflow.cli.Launcher - $> nextflow run main.nf -profile docker --poppipe_output /home/phemarajata/Downloads/PopPIPE-bp/output_with_samui_final --input /home/phemarajata/Downloads/PopPIPE-bp/combined_rfile.txt --outdir results_samuilplusall_tsv --snp_package parsnp
Jul-18 21:26:21.908 [main] DEBUG nextflow.cli.CmdRun - N E X T F L O W  ~  version 25.04.4
Jul-18 21:26:21.927 [main] DEBUG nextflow.plugin.PluginsFacade - Setting up plugin manager > mode=prod; embedded=false; plugins-dir=/home/phemarajata/.nextflow/plugins; core-plugins: nf-amazon@2.15.0,nf-azure@1.16.0,nf-cloudcache@0.4.3,nf-codecommit@0.2.3,nf-console@1.2.1,nf-google@1.21.0,nf-k8s@1.0.0,nf-tower@1.11.3,nf-wave@1.12.1
Jul-18 21:26:21.944 [main] INFO  o.pf4j.DefaultPluginStatusProvider - Enabled plugins: []
Jul-18 21:26:21.944 [main] INFO  o.pf4j.DefaultPluginStatusProvider - Disabled plugins: []
Jul-18 21:26:21.946 [main] INFO  org.pf4j.DefaultPluginManager - PF4J version 3.12.0 in 'deployment' mode
Jul-18 21:26:21.958 [main] INFO  org.pf4j.AbstractPluginManager - No plugins
Jul-18 21:26:21.974 [main] DEBUG nextflow.config.ConfigBuilder - Found config local: /home/phemarajata/Downloads/wf-assembly-snps-optimized_vm/nextflow.config
Jul-18 21:26:21.976 [main] DEBUG nextflow.config.ConfigBuilder - Parsing config file: /home/phemarajata/Downloads/wf-assembly-snps-optimized_vm/nextflow.config
Jul-18 21:26:21.997 [main] DEBUG n.secret.LocalSecretsProvider - Secrets store: /home/phemarajata/.nextflow/secrets/store.json
Jul-18 21:26:22.000 [main] DEBUG nextflow.secret.SecretsLoader - Discovered secrets providers: [nextflow.secret.LocalSecretsProvider@456be73c] - activable => nextflow.secret.LocalSecretsProvider@456be73c
Jul-18 21:26:22.017 [main] DEBUG nextflow.config.ConfigBuilder - Applying config profile: `docker`
Jul-18 21:26:22.971 [main] DEBUG nextflow.config.ConfigBuilder - Available config profiles: [aspen_hpc, debug, shifter, test, conda, gcp_vm, singularity, rosalind_hpc, test_full, docker]
Jul-18 21:26:23.007 [main] DEBUG nextflow.cli.CmdRun - Applied DSL=2 from script declaration
Jul-18 21:26:23.020 [main] DEBUG nextflow.cli.CmdRun - Launching `main.nf` [intergalactic_volhard] DSL2 - revision: 3a85b30ccc
Jul-18 21:26:23.021 [main] DEBUG nextflow.plugin.PluginsFacade - Plugins default=[]
Jul-18 21:26:23.021 [main] DEBUG nextflow.plugin.PluginsFacade - Plugins resolved requirement=[]
Jul-18 21:26:23.063 [main] DEBUG nextflow.Session - Session UUID: 0edb6ee7-23ed-4ea1-ace7-98c3a6d23e79
Jul-18 21:26:23.063 [main] DEBUG nextflow.Session - Run name: intergalactic_volhard
Jul-18 21:26:23.063 [main] DEBUG nextflow.Session - Executor pool size: 22
Jul-18 21:26:23.072 [main] DEBUG nextflow.file.FilePorter - File porter settings maxRetries=3; maxTransfers=50; pollTimeout=null
Jul-18 21:26:23.080 [main] DEBUG nextflow.util.ThreadPoolBuilder - Creating thread pool 'FileTransfer' minSize=10; maxSize=66; workQueue=LinkedBlockingQueue[-1]; allowCoreThreadTimeout=false
Jul-18 21:26:23.093 [main] DEBUG nextflow.cli.CmdRun - 
  Version: 25.04.4 build 5950
  Created: 16-06-2025 14:23 UTC (21:23 ICST)
  System: Linux 6.11.0-29-generic
  Runtime: Groovy 4.0.26 on Java HotSpot(TM) 64-Bit Server VM 17.0.12+8-LTS-286
  Encoding: UTF-8 (UTF-8)
  Process: 419890@phemarajata-Stealth-16-MercedesAMG-A1VGG [127.0.1.1]
  CPUs: 22 - Mem: 62.3 GB (33.8 GB) - Swap: 8 GB (8 GB)
Jul-18 21:26:23.110 [main] DEBUG nextflow.Session - Work-dir: /home/phemarajata/Downloads/wf-assembly-snps-optimized_vm/work [ext2/ext3]
Jul-18 21:26:23.130 [main] DEBUG nextflow.executor.ExecutorFactory - Extension executors providers=[]
Jul-18 21:26:23.139 [main] DEBUG nextflow.Session - Observer factory: DefaultObserverFactory
Jul-18 21:26:23.168 [main] DEBUG nextflow.Session - Observer factory (v2): LinObserverFactory
Jul-18 21:26:23.188 [main] DEBUG nextflow.cache.CacheFactory - Using Nextflow cache factory: nextflow.cache.DefaultCacheFactory
Jul-18 21:26:23.195 [main] DEBUG nextflow.util.CustomThreadPool - Creating default thread pool > poolSize: 23; maxThreads: 1000
Jul-18 21:26:23.238 [main] DEBUG nextflow.Session - Session start
Jul-18 21:26:23.241 [main] DEBUG nextflow.trace.TraceFileObserver - Workflow started -- trace file: /home/phemarajata/Downloads/wf-assembly-snps-optimized_vm/results_samuilplusall_tsv/pipeline_info/execution_trace_2025-07-18_21-26-22.txt
Jul-18 21:26:23.246 [main] DEBUG nextflow.Session - Using default localLib path: /home/phemarajata/Downloads/wf-assembly-snps-optimized_vm/lib
Jul-18 21:26:23.250 [main] DEBUG nextflow.Session - Adding to the classpath library: /home/phemarajata/Downloads/wf-assembly-snps-optimized_vm/lib
Jul-18 21:26:23.250 [main] DEBUG nextflow.Session - Adding to the classpath library: /home/phemarajata/Downloads/wf-assembly-snps-optimized_vm/lib/nfcore_external_java_deps.jar
Jul-18 21:26:23.834 [main] DEBUG nextflow.script.ScriptRunner - > Launching execution
Jul-18 21:26:23.878 [main] INFO  nextflow.Nextflow - 

-[2m----------------------------------------------------[0m-
[0;34m     __         __ __ __     __            __     __  __    [0m
[0;34m|  ||_  __  /\ (_ (_ |_ |\/||__)|  \_/ __ (_ |\ ||__)(_ [0m
[0;34m|/\||      /--\__)__)|__|  ||__)|__ |     __)| \||   __) [0m

[0;32m       Identify SNPs from genome assemblies.               [0m


[0;35m     bacterial-genomics/wf-assembly-snps v1.0.2[0m
-[2m----------------------------------------------------[0m-
[1mCore Nextflow options[0m
  [0;34mrunName             : [0;32mintergalactic_volhard[0m
  [0;34mcontainerEngine     : [0;32mdocker[0m
  [0;34mlaunchDir           : [0;32m/home/phemarajata/Downloads/wf-assembly-snps-optimized_vm[0m
  [0;34mworkDir             : [0;32m/home/phemarajata/Downloads/wf-assembly-snps-optimized_vm/work[0m
  [0;34mprojectDir          : [0;32m/home/phemarajata/Downloads/wf-assembly-snps-optimized_vm[0m
  [0;34muserName            : [0;32mphemarajata[0m
  [0;34mprofile             : [0;32mdocker[0m
  [0;34mconfigFiles         : [0;32m/home/phemarajata/Downloads/wf-assembly-snps-optimized_vm/nextflow.config[0m

[1mInput/output options[0m
  [0;34minput               : [0;32m/home/phemarajata/Downloads/PopPIPE-bp/combined_rfile.txt[0m
  [0;34moutdir              : [0;32mresults_samuilplusall_tsv[0m
  [0;34mpoppipe_output      : [0;32m/home/phemarajata/Downloads/PopPIPE-bp/output_with_samui_final[0m

[1mAnalysis options[0m
  [0;34mrecombination       : [0;32mgubbins[0m

[1mProfile options[0m
  [0;34mprofile_cache_dir   : [0;32m/home/phemarajata/Downloads/wf-assembly-snps-optimized_vm/assets/.cache[0m

[1mMax job request options[0m
  [0;34mmax_cpus            : [0;32m60[0m
  [0;34mmax_memory          : [0;32m400.GB[0m

[1mGeneric options[0m
  [0;34mtracedir            : [0;32mresults_samuilplusall_tsv/pipeline_info[0m
  [0;34mprocess_log_dir     : [0;32mresults_samuilplusall_tsv/pipeline_info/process_logs[0m
  [0;34mqc_filecheck_log_dir: [0;32mresults_samuilplusall_tsv/pipeline_info/qc_file_checks[0m

!! Only displaying parameters that differ from the pipeline defaults !!
-[2m----------------------------------------------------[0m-
If you use bacterial-genomics/wf-assembly-snps for your analysis please cite:

* The nf-core framework
  https://doi.org/10.1038/s41587-020-0439-x

* Software dependencies
  https://github.com/bacterial-genomics/wf-assembly-snps/blob/main/CITATIONS.md
-[2m----------------------------------------------------[0m-
Jul-18 21:26:23.945 [main] WARN  nextflow.Nextflow - Found unexpected parameters:
* --poppunk_clusters: null
Jul-18 21:26:23.945 [main] INFO  nextflow.Nextflow - - [2mIgnore this warning: params.schema_ignore_params = "poppunk_clusters" [0m
Jul-18 21:26:26.012 [main] INFO  nextflow.Nextflow - Parsing PopPIPE-bp output directory: /home/phemarajata/Downloads/PopPIPE-bp/output_with_samui_final
Jul-18 21:26:26.013 [main] INFO  nextflow.Nextflow - Input source: /home/phemarajata/Downloads/PopPIPE-bp/combined_rfile.txt
Jul-18 21:26:26.056 [main] DEBUG nextflow.script.ProcessConfig - Config settings `withLabel:process_single` matches labels `process_single` for process with name POPPIPE_SNP_ANALYSIS:PARSE_POPPIPE_OUTPUT
Jul-18 21:26:26.063 [main] DEBUG nextflow.executor.ExecutorFactory - << taskConfig executor: null
Jul-18 21:26:26.064 [main] DEBUG nextflow.executor.ExecutorFactory - >> processorType: 'local'
Jul-18 21:26:26.067 [main] DEBUG nextflow.executor.Executor - [warm up] executor > local
Jul-18 21:26:26.070 [main] DEBUG n.processor.LocalPollingMonitor - Creating local task monitor for executor 'local' > cpus=22; memory=62.3 GB; capacity=22; pollInterval=100ms; dumpInterval=5m
Jul-18 21:26:26.072 [main] DEBUG n.processor.TaskPollingMonitor - >>> barrier register (monitor: local)
Jul-18 21:26:26.084 [main] DEBUG nextflow.processor.TaskProcessor - Creating process 'POPPIPE_SNP_ANALYSIS:PARSE_POPPIPE_OUTPUT': maxForks=0; fair=false; array=0
Jul-18 21:26:26.172 [main] DEBUG nextflow.executor.ExecutorFactory - << taskConfig executor: null
Jul-18 21:26:26.173 [main] DEBUG nextflow.executor.ExecutorFactory - >> processorType: 'local'
Jul-18 21:26:26.175 [main] DEBUG nextflow.processor.TaskProcessor - Creating process 'POPPIPE_SNP_ANALYSIS:CLUSTER_SNP_ANALYSIS:INFILE_HANDLING_UNIX': maxForks=0; fair=false; array=0
Jul-18 21:26:26.221 [main] DEBUG nextflow.script.ProcessConfig - Config settings `withLabel:process_high` matches labels `process_high` for process with name POPPIPE_SNP_ANALYSIS:CLUSTER_SNP_ANALYSIS:CORE_GENOME_ALIGNMENT_PARSNP
Jul-18 21:26:26.222 [main] DEBUG nextflow.script.ProcessConfig - Config settings `withName:CORE_GENOME_ALIGNMENT_PARSNP` matches process POPPIPE_SNP_ANALYSIS:CLUSTER_SNP_ANALYSIS:CORE_GENOME_ALIGNMENT_PARSNP
Jul-18 21:26:26.225 [main] DEBUG nextflow.executor.ExecutorFactory - << taskConfig executor: null
Jul-18 21:26:26.225 [main] DEBUG nextflow.executor.ExecutorFactory - >> processorType: 'local'
Jul-18 21:26:26.226 [main] DEBUG nextflow.processor.TaskProcessor - Creating process 'POPPIPE_SNP_ANALYSIS:CLUSTER_SNP_ANALYSIS:CORE_GENOME_ALIGNMENT_PARSNP': maxForks=0; fair=false; array=0
Jul-18 21:26:26.233 [main] DEBUG nextflow.script.ProcessConfig - Config settings `withLabel:process_low` matches labels `process_low` for process with name POPPIPE_SNP_ANALYSIS:CLUSTER_SNP_ANALYSIS:CONVERT_GINGR_TO_FASTA_HARVESTTOOLS
Jul-18 21:26:26.234 [main] DEBUG nextflow.script.ProcessConfig - Config settings `withName:CONVERT_GINGR_TO_FASTA_HARVESTTOOLS` matches process POPPIPE_SNP_ANALYSIS:CLUSTER_SNP_ANALYSIS:CONVERT_GINGR_TO_FASTA_HARVESTTOOLS
Jul-18 21:26:26.235 [main] DEBUG nextflow.executor.ExecutorFactory - << taskConfig executor: null
Jul-18 21:26:26.235 [main] DEBUG nextflow.executor.ExecutorFactory - >> processorType: 'local'
Jul-18 21:26:26.236 [main] DEBUG nextflow.processor.TaskProcessor - Creating process 'POPPIPE_SNP_ANALYSIS:CLUSTER_SNP_ANALYSIS:CONVERT_GINGR_TO_FASTA_HARVESTTOOLS': maxForks=0; fair=false; array=0
Jul-18 21:26:26.243 [main] DEBUG nextflow.script.ProcessConfig - Config settings `withLabel:process_medium` matches labels `process_medium` for process with name POPPIPE_SNP_ANALYSIS:CLUSTER_SNP_ANALYSIS:CALCULATE_PAIRWISE_DISTANCES_SNP_DISTS
Jul-18 21:26:26.244 [main] DEBUG nextflow.script.ProcessConfig - Config settings `withName:CALCULATE_PAIRWISE_DISTANCES_SNP_DISTS` matches process POPPIPE_SNP_ANALYSIS:CLUSTER_SNP_ANALYSIS:CALCULATE_PAIRWISE_DISTANCES_SNP_DISTS
Jul-18 21:26:26.245 [main] DEBUG nextflow.executor.ExecutorFactory - << taskConfig executor: null
Jul-18 21:26:26.245 [main] DEBUG nextflow.executor.ExecutorFactory - >> processorType: 'local'
Jul-18 21:26:26.246 [main] DEBUG nextflow.processor.TaskProcessor - Creating process 'POPPIPE_SNP_ANALYSIS:CLUSTER_SNP_ANALYSIS:CALCULATE_PAIRWISE_DISTANCES_SNP_DISTS': maxForks=0; fair=false; array=0
Jul-18 21:26:26.254 [main] DEBUG nextflow.script.ProcessConfig - Config settings `withLabel:process_low` matches labels `process_low` for process with name POPPIPE_SNP_ANALYSIS:CLUSTER_SNP_ANALYSIS:CREATE_SNP_DISTANCE_MATRIX_SNP_DISTS
Jul-18 21:26:26.255 [main] DEBUG nextflow.script.ProcessConfig - Config settings `withName:CREATE_SNP_DISTANCE_MATRIX_SNP_DISTS` matches process POPPIPE_SNP_ANALYSIS:CLUSTER_SNP_ANALYSIS:CREATE_SNP_DISTANCE_MATRIX_SNP_DISTS
Jul-18 21:26:26.257 [main] DEBUG nextflow.executor.ExecutorFactory - << taskConfig executor: null
Jul-18 21:26:26.257 [main] DEBUG nextflow.executor.ExecutorFactory - >> processorType: 'local'
Jul-18 21:26:26.257 [main] DEBUG nextflow.processor.TaskProcessor - Creating process 'POPPIPE_SNP_ANALYSIS:CLUSTER_SNP_ANALYSIS:CREATE_SNP_DISTANCE_MATRIX_SNP_DISTS': maxForks=0; fair=false; array=0
Jul-18 21:26:26.266 [main] DEBUG nextflow.script.ProcessConfig - Config settings `withLabel:process_high` matches labels `process_high` for process with name POPPIPE_SNP_ANALYSIS:CLUSTER_SNP_ANALYSIS:RECOMBINATION:RECOMBINATION_GUBBINS
Jul-18 21:26:26.268 [main] DEBUG nextflow.script.ProcessConfig - Config settings `withName:RECOMBINATION_GUBBINS` matches process POPPIPE_SNP_ANALYSIS:CLUSTER_SNP_ANALYSIS:RECOMBINATION:RECOMBINATION_GUBBINS
Jul-18 21:26:26.271 [main] DEBUG nextflow.executor.ExecutorFactory - << taskConfig executor: null
Jul-18 21:26:26.271 [main] DEBUG nextflow.executor.ExecutorFactory - >> processorType: 'local'
Jul-18 21:26:26.271 [main] DEBUG nextflow.processor.TaskProcessor - Creating process 'POPPIPE_SNP_ANALYSIS:CLUSTER_SNP_ANALYSIS:RECOMBINATION:RECOMBINATION_GUBBINS': maxForks=0; fair=false; array=0
Jul-18 21:26:26.281 [main] DEBUG nextflow.script.ProcessConfig - Config settings `withLabel:process_medium` matches labels `process_medium` for process with name POPPIPE_SNP_ANALYSIS:CLUSTER_SNP_ANALYSIS:MASK_RECOMBINANT_POSITIONS_BIOPYTHON
Jul-18 21:26:26.282 [main] DEBUG nextflow.script.ProcessConfig - Config settings `withName:MASK_RECOMBINANT_POSITIONS_BIOPYTHON` matches process POPPIPE_SNP_ANALYSIS:CLUSTER_SNP_ANALYSIS:MASK_RECOMBINANT_POSITIONS_BIOPYTHON
Jul-18 21:26:26.283 [main] DEBUG nextflow.executor.ExecutorFactory - << taskConfig executor: null
Jul-18 21:26:26.283 [main] DEBUG nextflow.executor.ExecutorFactory - >> processorType: 'local'
Jul-18 21:26:26.284 [main] DEBUG nextflow.processor.TaskProcessor - Creating process 'POPPIPE_SNP_ANALYSIS:CLUSTER_SNP_ANALYSIS:MASK_RECOMBINANT_POSITIONS_BIOPYTHON': maxForks=0; fair=false; array=0
Jul-18 21:26:26.289 [main] DEBUG nextflow.script.ProcessConfig - Config settings `withLabel:process_medium` matches labels `process_medium` for process with name POPPIPE_SNP_ANALYSIS:CLUSTER_SNP_ANALYSIS:CREATE_MASKED_SNP_DISTANCE_MATRIX_SNP_DISTS
Jul-18 21:26:26.289 [main] DEBUG nextflow.script.ProcessConfig - Config settings `withName:CREATE_MASKED_SNP_DISTANCE_MATRIX_SNP_DISTS` matches process POPPIPE_SNP_ANALYSIS:CLUSTER_SNP_ANALYSIS:CREATE_MASKED_SNP_DISTANCE_MATRIX_SNP_DISTS
Jul-18 21:26:26.290 [main] DEBUG nextflow.executor.ExecutorFactory - << taskConfig executor: null
Jul-18 21:26:26.290 [main] DEBUG nextflow.executor.ExecutorFactory - >> processorType: 'local'
Jul-18 21:26:26.291 [main] DEBUG nextflow.processor.TaskProcessor - Creating process 'POPPIPE_SNP_ANALYSIS:CLUSTER_SNP_ANALYSIS:CREATE_MASKED_SNP_DISTANCE_MATRIX_SNP_DISTS': maxForks=0; fair=false; array=0
Jul-18 21:26:26.296 [main] DEBUG nextflow.script.ProcessConfig - Config settings `withLabel:process_high` matches labels `process_high` for process with name POPPIPE_SNP_ANALYSIS:CLUSTER_SNP_ANALYSIS:BUILD_PHYLOGENETIC_TREE_PARSNP
Jul-18 21:26:26.296 [main] DEBUG nextflow.script.ProcessConfig - Config settings `withName:BUILD_PHYLOGENETIC_TREE_PARSNP` matches process POPPIPE_SNP_ANALYSIS:CLUSTER_SNP_ANALYSIS:BUILD_PHYLOGENETIC_TREE_PARSNP
Jul-18 21:26:26.297 [main] DEBUG nextflow.executor.ExecutorFactory - << taskConfig executor: null
Jul-18 21:26:26.297 [main] DEBUG nextflow.executor.ExecutorFactory - >> processorType: 'local'
Jul-18 21:26:26.298 [main] DEBUG nextflow.processor.TaskProcessor - Creating process 'POPPIPE_SNP_ANALYSIS:CLUSTER_SNP_ANALYSIS:BUILD_PHYLOGENETIC_TREE_PARSNP': maxForks=0; fair=false; array=0
Jul-18 21:26:26.310 [main] DEBUG nextflow.script.ProcessConfig - Config settings `withLabel:process_medium` matches labels `process_medium` for process with name POPPIPE_SNP_ANALYSIS:TREE_GRAFT
Jul-18 21:26:26.312 [main] DEBUG nextflow.executor.ExecutorFactory - << taskConfig executor: null
Jul-18 21:26:26.312 [main] DEBUG nextflow.executor.ExecutorFactory - >> processorType: 'local'
Jul-18 21:26:26.312 [main] DEBUG nextflow.processor.TaskProcessor - Creating process 'POPPIPE_SNP_ANALYSIS:TREE_GRAFT': maxForks=0; fair=false; array=0
Jul-18 21:26:26.338 [main] DEBUG nextflow.Session - Workflow process names [dsl2]: INFILE_HANDLING_UNIX, POPPIPE_SNP_ANALYSIS:CLUSTER_SNP_ANALYSIS:CREATE_SNP_DISTANCE_MATRIX_SNP_DISTS, POPPIPE_SNP_ANALYSIS:CLUSTER_SNP_ANALYSIS:CALCULATE_PAIRWISE_DISTANCES_SNP_DISTS, PARSE_POPPUNK_CLUSTERS, POPPIPE_SNP_ANALYSIS:PARSE_POPPIPE_OUTPUT, POPPIPE_SNP_ANALYSIS:CLUSTER_SNP_ANALYSIS:CORE_GENOME_ALIGNMENT_PARSNP, TREE_GRAFT, POPPIPE_SNP_ANALYSIS:CLUSTER_SNP_ANALYSIS:RECOMBINATION:RECOMBINATION_GUBBINS, POPPIPE_SNP_ANALYSIS:CLUSTER_SNP_ANALYSIS:BUILD_PHYLOGENETIC_TREE_PARSNP, CREATE_SNP_DISTANCE_MATRIX_SNP_DISTS, POPPIPE_SNP_ANALYSIS:CLUSTER_SNP_ANALYSIS:CONVERT_GINGR_TO_FASTA_HARVESTTOOLS, POPPIPE_SNP_ANALYSIS:CLUSTER_SNP_ANALYSIS:INFILE_HANDLING_UNIX, CONVERT_GINGR_TO_FASTA_HARVESTTOOLS, MASK_RECOMBINANT_POSITIONS_BIOPYTHON, CORE_GENOME_ALIGNMENT_PARSNP, POPPIPE_SNP_ANALYSIS:TREE_GRAFT, REF_INFILE_HANDLING_UNIX, CONVERT_TSV_TO_EXCEL_PYTHON, CALCULATE_PAIRWISE_DISTANCES_SNP_DISTS, CONVERT_SAMPLESHEET_PYTHON, RECOMBINATION_GUBBINS, CREATE_EXCEL_RUN_SUMMARY_PYTHON, CREATE_MASKED_SNP_DISTANCE_MATRIX_SNP_DISTS, POPPIPE_SNP_ANALYSIS:CLUSTER_SNP_ANALYSIS:MASK_RECOMBINANT_POSITIONS_BIOPYTHON, POPPIPE_SNP_ANALYSIS:CLUSTER_SNP_ANALYSIS:CREATE_MASKED_SNP_DISTANCE_MATRIX_SNP_DISTS, BUILD_PHYLOGENETIC_TREE_PARSNP, RECOMBINATION_CLONALFRAMEML, PARSE_POPPIPE_OUTPUT
Jul-18 21:26:26.344 [main] DEBUG nextflow.Session - Igniting dataflow network (19)
Jul-18 21:26:26.345 [main] DEBUG nextflow.processor.TaskProcessor - Starting process > POPPIPE_SNP_ANALYSIS:PARSE_POPPIPE_OUTPUT
Jul-18 21:26:26.346 [main] DEBUG nextflow.processor.TaskProcessor - Starting process > POPPIPE_SNP_ANALYSIS:CLUSTER_SNP_ANALYSIS:INFILE_HANDLING_UNIX
Jul-18 21:26:26.346 [main] DEBUG nextflow.processor.TaskProcessor - Starting process > POPPIPE_SNP_ANALYSIS:CLUSTER_SNP_ANALYSIS:CORE_GENOME_ALIGNMENT_PARSNP
Jul-18 21:26:26.346 [main] DEBUG nextflow.processor.TaskProcessor - Starting process > POPPIPE_SNP_ANALYSIS:CLUSTER_SNP_ANALYSIS:CONVERT_GINGR_TO_FASTA_HARVESTTOOLS
Jul-18 21:26:26.346 [main] DEBUG nextflow.processor.TaskProcessor - Starting process > POPPIPE_SNP_ANALYSIS:CLUSTER_SNP_ANALYSIS:CALCULATE_PAIRWISE_DISTANCES_SNP_DISTS
Jul-18 21:26:26.346 [main] DEBUG nextflow.processor.TaskProcessor - Starting process > POPPIPE_SNP_ANALYSIS:CLUSTER_SNP_ANALYSIS:CREATE_SNP_DISTANCE_MATRIX_SNP_DISTS
Jul-18 21:26:26.346 [main] DEBUG nextflow.processor.TaskProcessor - Starting process > POPPIPE_SNP_ANALYSIS:CLUSTER_SNP_ANALYSIS:RECOMBINATION:RECOMBINATION_GUBBINS
Jul-18 21:26:26.347 [main] DEBUG nextflow.processor.TaskProcessor - Starting process > POPPIPE_SNP_ANALYSIS:CLUSTER_SNP_ANALYSIS:MASK_RECOMBINANT_POSITIONS_BIOPYTHON
Jul-18 21:26:26.347 [main] DEBUG nextflow.processor.TaskProcessor - Starting process > POPPIPE_SNP_ANALYSIS:CLUSTER_SNP_ANALYSIS:CREATE_MASKED_SNP_DISTANCE_MATRIX_SNP_DISTS
Jul-18 21:26:26.347 [main] DEBUG nextflow.processor.TaskProcessor - Starting process > POPPIPE_SNP_ANALYSIS:CLUSTER_SNP_ANALYSIS:BUILD_PHYLOGENETIC_TREE_PARSNP
Jul-18 21:26:26.347 [main] DEBUG nextflow.processor.TaskProcessor - Starting process > POPPIPE_SNP_ANALYSIS:TREE_GRAFT
Jul-18 21:26:26.348 [main] DEBUG nextflow.script.ScriptRunner - Parsed script files:
  Script_b9a8232e0fa11be0: /home/phemarajata/Downloads/wf-assembly-snps-optimized_vm/modules/local/create_masked_snp_distance_matrix_snp_dists/main.nf
  Script_34d6452007ce58e7: /home/phemarajata/Downloads/wf-assembly-snps-optimized_vm/workflows/poppipe_snp_analysis.nf
  Script_de42343b4a60b37d: /home/phemarajata/Downloads/wf-assembly-snps-optimized_vm/modules/local/create_snp_distance_matrix_snp_dists/main.nf
  Script_d1036ae6ef6995e2: /home/phemarajata/Downloads/wf-assembly-snps-optimized_vm/modules/local/parse_poppipe_output/main.nf
  Script_6ef5bdac66e9e392: /home/phemarajata/Downloads/wf-assembly-snps-optimized_vm/modules/local/build_phylogenetic_tree_parsnp/main.nf
  Script_cf92b0cfd5970f35: /home/phemarajata/Downloads/wf-assembly-snps-optimized_vm/modules/local/convert_samplesheet_python/main.nf
  Script_af27fc3efabe901d: /home/phemarajata/Downloads/wf-assembly-snps-optimized_vm/subworkflows/local/input_check.nf
  Script_53027aa9816972db: /home/phemarajata/Downloads/wf-assembly-snps-optimized_vm/modules/local/calculate_pairwise_distances_snp_dists/main.nf
  Script_d97613bdf9c0d9be: /home/phemarajata/Downloads/wf-assembly-snps-optimized_vm/modules/local/convert_gingr_to_fasta_harvesttools/main.nf
  Script_cf1907f7a901597f: /home/phemarajata/Downloads/wf-assembly-snps-optimized_vm/workflows/assembly_snps.nf
  Script_62f9f54335ad34eb: /home/phemarajata/Downloads/wf-assembly-snps-optimized_vm/modules/local/tree_graft/main.nf
  Script_daab3931d6dbebc6: /home/phemarajata/Downloads/wf-assembly-snps-optimized_vm/modules/local/convert_tsv_to_excel_python/main.nf
  Script_bdfe511ac4c90ab8: /home/phemarajata/Downloads/wf-assembly-snps-optimized_vm/subworkflows/local/recombination.nf
  Script_92a8fd2e65506f13: /home/phemarajata/Downloads/wf-assembly-snps-optimized_vm/modules/local/create_excel_run_summary_python/main.nf
  Script_7ff909c4ed363959: /home/phemarajata/Downloads/wf-assembly-snps-optimized_vm/modules/local/recombination_gubbins/main.nf
  Script_91cc3a7de431b47a: /home/phemarajata/Downloads/wf-assembly-snps-optimized_vm/workflows/assembly_snps_clustered.nf
  Script_b149fc8549e9d7d6: /home/phemarajata/Downloads/wf-assembly-snps-optimized_vm/subworkflows/local/cluster_snp_analysis/main.nf
  Script_c73b08b3baf6307d: /home/phemarajata/Downloads/wf-assembly-snps-optimized_vm/modules/local/parse_poppunk_clusters/main.nf
  Script_67f829c2679504c2: /home/phemarajata/Downloads/wf-assembly-snps-optimized_vm/modules/local/core_genome_alignment_parsnp/main.nf
  Script_3a61c0462a84f870: /home/phemarajata/Downloads/wf-assembly-snps-optimized_vm/modules/local/infile_handling_unix/main.nf
  Script_5ca559834abe9e5f: /home/phemarajata/Downloads/wf-assembly-snps-optimized_vm/main.nf
  Script_30224b4410519b3a: /home/phemarajata/Downloads/wf-assembly-snps-optimized_vm/modules/local/mask_recombinant_positions_biopython/main.nf
  Script_24820bed3f05c1d0: /home/phemarajata/Downloads/wf-assembly-snps-optimized_vm/modules/local/recombination_clonalframeml/main.nf
Jul-18 21:26:26.348 [main] DEBUG nextflow.script.ScriptRunner - > Awaiting termination 
Jul-18 21:26:26.348 [main] DEBUG nextflow.Session - Session await
Jul-18 21:26:26.474 [Task submitter] DEBUG n.executor.local.LocalTaskHandler - Launch cmd line: /bin/bash -ue .command.run
Jul-18 21:26:26.477 [Task submitter] INFO  nextflow.Session - [7b/0afe62] Submitted process > POPPIPE_SNP_ANALYSIS:PARSE_POPPIPE_OUTPUT (PopPIPE output parsing)
Jul-18 21:26:30.294 [Task monitor] DEBUG n.processor.TaskPollingMonitor - Task completed > TaskHandler[id: 1; name: POPPIPE_SNP_ANALYSIS:PARSE_POPPIPE_OUTPUT (PopPIPE output parsing); status: COMPLETED; exit: 1; error: -; workDir: /home/phemarajata/Downloads/wf-assembly-snps-optimized_vm/work/7b/0afe622fee4ee70f82013c49703069]
Jul-18 21:26:30.294 [Task monitor] DEBUG nextflow.util.ThreadPoolBuilder - Creating thread pool 'TaskFinalizer' minSize=10; maxSize=66; workQueue=LinkedBlockingQueue[-1]; allowCoreThreadTimeout=false
Jul-18 21:26:30.302 [TaskFinalizer-1] DEBUG nextflow.processor.TaskProcessor - Handling unexpected condition for
  task: name=POPPIPE_SNP_ANALYSIS:PARSE_POPPIPE_OUTPUT (PopPIPE output parsing); work-dir=/home/phemarajata/Downloads/wf-assembly-snps-optimized_vm/work/7b/0afe622fee4ee70f82013c49703069
  error [nextflow.exception.ProcessFailedException]: Process `POPPIPE_SNP_ANALYSIS:PARSE_POPPIPE_OUTPUT (PopPIPE output parsing)` terminated with an error exit status (1)
Jul-18 21:26:30.312 [TaskFinalizer-1] ERROR nextflow.processor.TaskProcessor - Error executing process > 'POPPIPE_SNP_ANALYSIS:PARSE_POPPIPE_OUTPUT (PopPIPE output parsing)'

Caused by:
  Process `POPPIPE_SNP_ANALYSIS:PARSE_POPPIPE_OUTPUT (PopPIPE output parsing)` terminated with an error exit status (1)


Command executed:

  #!/usr/bin/env python3
  
  import pandas as pd
  import os
  import json
  import glob
  from pathlib import Path
  
  # Find the CSV file with cluster assignments in PopPIPE output
  csv_files = []
  poppipe_dir = 'output_with_samui_final'
  
  # Look for CSV files in various locations
  search_patterns = [
      os.path.join(poppipe_dir, '*_clusters.csv'),
      os.path.join(poppipe_dir, '*.csv'),
      os.path.join(poppipe_dir, 'output', '*_clusters.csv'),
      os.path.join(poppipe_dir, 'output', '*.csv')
  ]
  
  for pattern in search_patterns:
      csv_files.extend(glob.glob(pattern))
  
  if not csv_files:
      raise FileNotFoundError(f"No CSV file found in PopPIPE output directory: {poppipe_dir}")
  
  csv_file = csv_files[0]
  print(f"Using CSV file: {csv_file}")
  
  # Read cluster assignments
  df = pd.read_csv(csv_file)
  print(f"CSV columns: {df.columns.tolist()}")
  print(f"CSV shape: {df.shape}")
  
  # Try to identify the correct columns
  sample_col = None
  cluster_col = None
  
  # Common column names for samples
  sample_candidates = ['Taxon', 'Sample', 'sample', 'ID', 'id', 'Name', 'name']
  for col in sample_candidates:
      if col in df.columns:
          sample_col = col
          break
  
  # Common column names for clusters
  cluster_candidates = ['Cluster', 'cluster', 'Cluster_ID', 'cluster_id']
  for col in cluster_candidates:
      if col in df.columns:
          cluster_col = col
          break
  
  if not sample_col or not cluster_col:
      print(f"Available columns: {df.columns.tolist()}")
      raise ValueError(f"Could not identify sample column ({sample_col}) or cluster column ({cluster_col})")
  
  print(f"Using sample column: {sample_col}, cluster column: {cluster_col}")
  
  # Determine if input_source is a TSV file or directory
  input_source_path = 'combined_rfile.txt'
  sample_to_file = {}
  
  if os.path.isfile(input_source_path):
      # Input is a TSV file (rfiles.txt, combined.txt, etc.)
      print(f"Reading sample-to-file mapping from TSV: {input_source_path}")
      
      try:
          # Read TSV file - assume tab-separated with sample_name	file_path format
          with open(input_source_path, 'r') as f:
              for line_num, line in enumerate(f, 1):
                  line = line.strip()
                  if not line or line.startswith('#'):  # Skip empty lines and comments
                      continue
                  
                  parts = line.split('	')
                  if len(parts) >= 2:
                      sample_name = parts[0].strip()
                      file_path = parts[1].strip()
                      
                      # Verify file exists
                      if os.path.isfile(file_path):
                          sample_to_file[sample_name] = file_path
                          print(f"Mapped '{sample_name}' to '{file_path}'")
                      else:
                          print(f"Warning: File not found for sample '{sample_name}': {file_path}")
                  else:
                      print(f"Warning: Invalid format at line {line_num}: {line}")
          
          print(f"Loaded {len(sample_to_file)} sample-to-file mappings from TSV")
          
      except Exception as e:
          print(f"Error reading TSV file: {e}")
          raise
  
  elif os.path.isdir(input_source_path):
      # Input is a directory - use original file discovery logic
      print(f"Discovering assembly files in directory: {input_source_path}")
      
      input_files = []
      for ext in ['.fasta', '.fas', '.fna', '.fsa', '.fa', '.fasta.gz', '.fas.gz', '.fna.gz', '.fsa.gz', '.fa.gz']:
          pattern = os.path.join(input_source_path, f"*{ext}")
          input_files.extend(glob.glob(pattern))
      
      print(f"Found {len(input_files)} input assembly files")
      
      # Create mapping of sample names to files using filename-based matching
      for file_path in input_files:
          file = os.path.basename(file_path)
          sample_name = Path(file).stem
          
          # Remove common genomic file extensions
          for ext in ['.genomic', '.fasta', '.fas', '.fna', '.fsa', '.fa']:
              if sample_name.endswith(ext):
                  sample_name = sample_name[:-len(ext)]
          
          # Create multiple variants for matching
          variants = set([sample_name])
          
          # Remove common suffixes
          clean_name = sample_name.replace('-SPAdes', '').replace('_contigs', '').replace('_genomic', '')
          variants.add(clean_name)
          
          # Extract base sample ID
          if '_' in clean_name:
              base_name = clean_name.split('_')[0]
              if len(base_name) > 3:
                  variants.add(base_name)
          
          if '-' in clean_name:
              base_name = clean_name.split('-')[0]
              if len(base_name) > 3:
                  variants.add(base_name)
          
          # For GCA/GCF accessions
          if clean_name.startswith(('GCA_', 'GCF_')):
              parts = clean_name.split('_')
              if len(parts) >= 2:
                  accession = '_'.join(parts[:2])
                  variants.add(accession)
          
          for variant in variants:
              if variant:
                  sample_to_file[variant] = file_path
  
  else:
      raise ValueError(f"Input source is neither a file nor directory: {input_source_path}")
  
  # Find strain directories in PopPIPE output
  strain_dirs = []
  possible_strain_paths = [
      os.path.join(poppipe_dir, 'strain'),
      os.path.join(poppipe_dir, 'strains'),
      os.path.join(poppipe_dir, 'output', 'strain'),
      os.path.join(poppipe_dir, 'output', 'strains')
  ]
  
  cluster_info = {}
  for strain_path in possible_strain_paths:
      if os.path.exists(strain_path):
          for cluster_dir in os.listdir(strain_path):
              cluster_path = os.path.join(strain_path, cluster_dir)
              if os.path.isdir(cluster_path):
                  cluster_info[cluster_dir] = {
                      'path': cluster_path,
                      'files': os.listdir(cluster_path)
                  }
          break
  
  print(f"Found {len(cluster_info)} cluster directories in strain folder")
  
  # Group by cluster and create cluster files
  clusters = df.groupby(cluster_col)
  cluster_summary = []
  
  for cluster_id, group in clusters:
      cluster_files = []
      cluster_filename = f"cluster_{cluster_id}.txt"
      
      with open(cluster_filename, 'w') as f:
          for _, row in group.iterrows():
              sample_name = row[sample_col]
              matched_file = None
              
              # Try exact match first
              if sample_name in sample_to_file:
                  matched_file = sample_to_file[sample_name]
              else:
                  # Try fuzzy matching (only if input was a directory, not TSV)
                  if os.path.isdir(input_source_path):
                      for variant, file_path in sample_to_file.items():
                          if (sample_name in variant or variant in sample_name or 
                              sample_name.replace('_', '').replace('-', '') == variant.replace('_', '').replace('-', '')):
                              matched_file = file_path
                              break
              
              if matched_file:
                  f.write(f"{matched_file}\n")
                  cluster_files.append(matched_file)
                  print(f"Matched '{sample_name}' to '{matched_file}'")
              else:
                  print(f"No match found for sample: '{sample_name}'")
      
      cluster_summary.append({
          'Cluster': cluster_id,
          'Sample_Count': len(cluster_files),
          'Samples': ';'.join([Path(f).stem for f in cluster_files]),
          'Has_PopPIPE_Data': str(cluster_id) in cluster_info
      })
  
  # Write summary
  summary_df = pd.DataFrame(cluster_summary)
  summary_df.to_csv('cluster_summary.tsv', sep='\t', index=False)
  
  # Write cluster info JSON
  with open('cluster_info.json', 'w') as f:
      json.dump(cluster_info, f, indent=2)
  
  print(f"Created {len(clusters)} cluster files")
  for _, row in summary_df.iterrows():
      print(f"Cluster {row['Cluster']}: {row['Sample_Count']} samples, PopPIPE data: {row['Has_PopPIPE_Data']}")
  
  # Write versions
  with open('versions.yml', 'w') as f:
      f.write('"POPPIPE_SNP_ANALYSIS:PARSE_POPPIPE_OUTPUT":\n')
      f.write('    python: "3.9"\n')
      f.write('    pandas: "2.2.3"\n')

Command exit status:
  1

Command output:
  Using CSV file: output_with_samui_final/data_with_samui_enriched.csv
  CSV columns: ['id', 'Strain__autocolour', 'Subcluster_1__autocolour', 'Subcluster_2__autocolour', 'Subcluster_3__autocolour', 'city', 'country', 'continent', 'division', 'subdivision', 'IsolateType', 'IsolateType__shape', 'latitude', 'longitude']
  CSV shape: (3592, 14)
  Available columns: ['id', 'Strain__autocolour', 'Subcluster_1__autocolour', 'Subcluster_2__autocolour', 'Subcluster_3__autocolour', 'city', 'country', 'continent', 'division', 'subdivision', 'IsolateType', 'IsolateType__shape', 'latitude', 'longitude']

Command error:
  Unable to find image 'staphb/pandas:2.2.3' locally
  2.2.3: Pulling from staphb/pandas
  6414378b6477: Already exists
  59399f7e7774: Pulling fs layer
  471a0cda3696: Pulling fs layer
  9b9de92c7df0: Pulling fs layer
  9b9de92c7df0: Download complete
  471a0cda3696: Verifying Checksum
  471a0cda3696: Download complete
  59399f7e7774: Download complete
  59399f7e7774: Pull complete
  471a0cda3696: Pull complete
  9b9de92c7df0: Pull complete
  Digest: sha256:d0a44776ddf6069915c3525088218950bf99fc084a23d7f2bba8b80b07e3383f
  Status: Downloaded newer image for staphb/pandas:2.2.3
  Using CSV file: output_with_samui_final/data_with_samui_enriched.csv
  CSV columns: ['id', 'Strain__autocolour', 'Subcluster_1__autocolour', 'Subcluster_2__autocolour', 'Subcluster_3__autocolour', 'city', 'country', 'continent', 'division', 'subdivision', 'IsolateType', 'IsolateType__shape', 'latitude', 'longitude']
  CSV shape: (3592, 14)
  Available columns: ['id', 'Strain__autocolour', 'Subcluster_1__autocolour', 'Subcluster_2__autocolour', 'Subcluster_3__autocolour', 'city', 'country', 'continent', 'division', 'subdivision', 'IsolateType', 'IsolateType__shape', 'latitude', 'longitude']
  Traceback (most recent call last):
    File ".command.sh", line 55, in <module>
      raise ValueError(f"Could not identify sample column ({sample_col}) or cluster column ({cluster_col})")
  ValueError: Could not identify sample column (id) or cluster column (None)

Work dir:
  /home/phemarajata/Downloads/wf-assembly-snps-optimized_vm/work/7b/0afe622fee4ee70f82013c49703069

Container:
  staphb/pandas:2.2.3

Tip: you can replicate the issue by changing to the process work dir and entering the command `bash .command.run`
Jul-18 21:26:30.322 [TaskFinalizer-1] INFO  nextflow.Session - Execution cancelled -- Finishing pending tasks before exit
Jul-18 21:26:30.325 [main] DEBUG nextflow.Session - Session await > all processes finished
Jul-18 21:26:30.326 [Task monitor] DEBUG n.processor.TaskPollingMonitor - <<< barrier arrives (monitor: local) - terminating tasks monitor poll loop
Jul-18 21:26:30.326 [main] DEBUG nextflow.Session - Session await > all barriers passed
Jul-18 21:26:30.327 [Actor Thread 14] DEBUG nextflow.file.SortFileCollector - FileCollector temp dir not removed: null
Jul-18 21:26:30.327 [Actor Thread 13] DEBUG nextflow.file.SortFileCollector - FileCollector temp dir not removed: null
Jul-18 22:16:39.241 [SIGINT handler] DEBUG nextflow.Session - Session aborted -- Cause: SIGINT
Jul-18 22:16:39.257 [main] INFO  nextflow.Nextflow - -[0;35m[bacterial-genomics/wf-assembly-snps][0;31m Pipeline completed with errors[0m-
Jul-18 22:16:39.258 [main] INFO  nextflow.Nextflow - -[0;35m[bacterial-genomics/wf-assembly-snps][0;31m Pipeline completed with errors[0m-
Jul-18 22:16:39.258 [main] INFO  nextflow.Nextflow - -[0;35m[bacterial-genomics/wf-assembly-snps][0;31m Pipeline completed with errors[0m-
Jul-18 22:16:39.258 [main] INFO  nextflow.Nextflow - -[0;35m[bacterial-genomics/wf-assembly-snps][0;31m Pipeline completed with errors[0m-
Jul-18 22:16:39.261 [main] DEBUG n.trace.WorkflowStatsObserver - Workflow completed > WorkflowStats[succeededCount=0; failedCount=1; ignoredCount=0; cachedCount=0; pendingCount=0; submittedCount=0; runningCount=0; retriesCount=0; abortedCount=0; succeedDuration=0ms; failedDuration=3.7s; cachedDuration=0ms;loadCpus=0; loadMemory=0; peakRunning=1; peakCpus=1; peakMemory=8 GB; ]
Jul-18 22:16:39.261 [main] DEBUG nextflow.trace.TraceFileObserver - Workflow completed -- saving trace file
Jul-18 22:16:39.261 [main] DEBUG nextflow.trace.ReportObserver - Workflow completed -- rendering execution report
Jul-18 22:16:39.522 [main] DEBUG nextflow.trace.TimelineObserver - Workflow completed -- rendering execution timeline
Jul-18 22:16:39.571 [main] DEBUG nextflow.cache.CacheDB - Closing CacheDB done
Jul-18 22:16:39.577 [main] DEBUG nextflow.script.ScriptRunner - > Execution complete -- Goodbye
